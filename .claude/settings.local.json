{
  "permissions": {
    "allow": [
      "Bash(/Users/pablo/Code/InternalPortalDemo/src/Core/InternalPortal.Application/Features/Auth/Commands/LoginCommandHandler.cs << 'CSHARPEOF'\nusing InternalPortal.Application.Common.Interfaces;\nusing InternalPortal.Application.Features.Auth.DTOs;\nusing InternalPortal.Domain.Entities;\nusing InternalPortal.Domain.Interfaces;\nusing MediatR;\n\nnamespace InternalPortal.Application.Features.Auth.Commands;\n\npublic class LoginCommandHandler : IRequestHandler<LoginCommand, AuthResponse>\n{\n    private readonly IUserRepository _userRepository;\n    private readonly IIdentityService _identityService;\n    private readonly IJwtService _jwtService;\n    private readonly IRefreshTokenRepository _refreshTokenRepository;\n    private readonly IUnitOfWork _unitOfWork;\n\n    public LoginCommandHandler\\(\n        IUserRepository userRepository,\n        IIdentityService identityService,\n        IJwtService jwtService,\n        IRefreshTokenRepository refreshTokenRepository,\n        IUnitOfWork unitOfWork\\)\n    {\n        _userRepository = userRepository;\n        _identityService = identityService;\n        _jwtService = jwtService;\n        _refreshTokenRepository = refreshTokenRepository;\n        _unitOfWork = unitOfWork;\n    }\n\n    public async Task<AuthResponse> Handle\\(LoginCommand request, CancellationToken cancellationToken\\)\n    {\n        var user = await _userRepository.GetByEmailAsync\\(request.Email, cancellationToken\\)\n            ?? throw new ApplicationException\\(\"Invalid email or password.\"\\);\n\n        if \\(!user.IsActive\\)\n            throw new ApplicationException\\(\"Account is deactivated.\"\\);\n\n        if \\(!_identityService.VerifyPassword\\(request.Password, user.PasswordHash\\)\\)\n            throw new ApplicationException\\(\"Invalid email or password.\"\\);\n\n        var accessToken = _jwtService.GenerateAccessToken\\(user\\);\n        var refreshTokenValue = _jwtService.GenerateRefreshToken\\(\\);\n\n        var refreshToken = new RefreshToken\n        {\n            Id = Guid.NewGuid\\(\\),\n            Token = refreshTokenValue,\n            UserId = user.Id,\n            ExpiresUtc = DateTime.UtcNow.AddDays\\(7\\),\n            CreatedAtUtc = DateTime.UtcNow\n        };\n\n        await _refreshTokenRepository.AddAsync\\(refreshToken, cancellationToken\\);\n        await _unitOfWork.SaveChangesAsync\\(cancellationToken\\);\n\n        return new AuthResponse\\(\n            accessToken,\n            refreshTokenValue,\n            DateTime.UtcNow.AddHours\\(1\\),\n            new UserDto\\(user.Id, user.Email, user.FirstName, user.LastName, user.Department, user.Role.ToString\\(\\)\\)\\);\n    }\n}\nCSHARPEOF)",
      "Bash(/Users/pablo/Code/InternalPortalDemo/src/Core/InternalPortal.Application/Features/Auth/Commands/LoginCommandValidator.cs << 'CSHARPEOF'\nusing FluentValidation;\n\nnamespace InternalPortal.Application.Features.Auth.Commands;\n\npublic class LoginCommandValidator : AbstractValidator<LoginCommand>\n{\n    public LoginCommandValidator\\(\\)\n    {\n        RuleFor\\(x => x.Email\\).NotEmpty\\(\\).EmailAddress\\(\\);\n        RuleFor\\(x => x.Password\\).NotEmpty\\(\\);\n    }\n}\nCSHARPEOF)",
      "Bash(/Users/pablo/Code/InternalPortalDemo/src/Core/InternalPortal.Application/Features/Auth/Commands/RefreshTokenCommand.cs << 'CSHARPEOF'\nusing InternalPortal.Application.Features.Auth.DTOs;\nusing MediatR;\n\nnamespace InternalPortal.Application.Features.Auth.Commands;\n\npublic record RefreshTokenCommand\\(string RefreshToken\\) : IRequest<AuthResponse>;\nCSHARPEOF)",
      "Bash(/Users/pablo/Code/InternalPortalDemo/src/Core/InternalPortal.Application/Features/Reports/Queries/GetPopularEventsReportQuery.cs << 'CSHARPEOF'\nusing InternalPortal.Application.Features.Reports.DTOs;\nusing MediatR;\n\nnamespace InternalPortal.Application.Features.Reports.Queries;\n\npublic record GetPopularEventsReportQuery\\(int Top = 10\\) : IRequest<IReadOnlyList<PopularEventDto>>;\nCSHARPEOF)"
    ]
  }
}
